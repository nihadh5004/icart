{% extends 'profile_base.html' %}
{% load static %}

{% block content %}
<div class=" mt-5 ml-5 col-9 rounded">
    <nav class="navbar navbar-light bg-light  justify-content-between">
      <a class="navbar-brand font-weight-bold"  style="font-family: Century Gothic;">My Orders</a>
    
    
      
    </nav>
    
    <table class="table table-striped table-light mt-2"  style="font-family: Century Gothic;">
      <thead>
        <tr>
          <th scope="col">Order Id</th>
          <th scope="col">Ordered Date</th>
          <th scope="col">Expected Delivery </th>
          <th scope="col">Order Total</th>
          <th scope="col">Order status</th>
          <th scope="col">Payment </th>
          <th scope="col">Actions</th>
         
        </tr>
      </thead>
      <tbody>
        {% for order in  orders %}
        <tr>
          <th >{{order.id}}</th>
          <td>{{ order.order_date.date}}</td>
          <td>{{ order.delivery_date.date}}</td>
          <td>{{ order.total_price}}</td>
          <td>{{ order.payment_status}}</td>
          <td>{{ order.payment_method}}</td>
          <td> <a href="{% url 'user_order_detail' order.id %}">  <button class="btn btn-outline-secondary">View Details</button></a>
                   
          </td>
        
        </tr>
        {% endfor %}
      </tbody>
    </table>
      <!-- Pagination -->
      {% if orders.has_other_pages %}
      <div class="row w-100 col-12">
        <div class="col-12">
          
          <nav aria-label="navigation">
            <ul class="pagination justify-content-center mt-50">
              {% if orders.has_previous %}
                {% comment %} <li class="page-item"><a class="page-link" href="?page=1">First</a></li> {% endcomment %}
                <li class="page-item"><a class="page-link" href="?page={{ orders.previous_page_number }}"><</a></li>
              {% endif %}
    
              
              <li class="page-item active"><a class="page-link" href="?page={{ orders.number }}">{{ orders.number }}</a></li>
               
    
              {% if orders.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ orders.next_page_number }}">></a></li>
                {% comment %} <li class="page-item"><a class="page-link" href="?page={{ products.paginator.num_pages }}">Last</a></li> {% endcomment %}
              {% endif %}
            </ul>
          </nav>
        </div>
      </div>
    {% endif %}
    </div>
<script>
  function initiateRefundAndCancelOrder(orderId) {
    // AJAX call to initiate refund
    $.ajax({
      url: '/initiate_refund',
      method: 'POST',
      headers: { 'X-CSRFToken': '{{ csrf_token }}' },
      data: { order_id: orderId },
      success: function(response) {
        alert('Refund inititated, will be back in 2-7 days')
        cancelOrder(orderId);
      },
      error: function(xhr, status, error) {
        console.log('Refund error:', error);
        // Handle the refund error if needed
      }
    });
  }
  
  function cancelOrder(orderId) {
    // AJAX call to cancel the order
    $.ajax({
      url: '/_cancel_order' ,
      method: 'POST',
      headers: { 'X-CSRFToken': '{{ csrf_token }}' },
      data: { order_id: orderId },
      success: function(response) {
        alert('Order has been succesfully cancelled')
        location.reload();
        // Order canceled successfully
        // Handle any additional actions or update the UI as needed
      },
      error: function(xhr, status, error) {
        console.log('Cancel order error:', error);
        // Handle the cancel order error if needed
      }
    });
  }
  
</script>



<!-- ##### jQuery (Necessary for All JavaScript Plugins) ##### -->
<script src="{% static 'js/jquery/jquery-2.2.4.min.js' %}"></script>
<!-- Popper js -->
<script src="{% static 'js/popper.min.js' %}"></script>
<!-- Bootstrap js -->
<script src="{% static 'js/bootstrap.min.js' %}"></script>
<!-- Plugins js -->
<script src="{% static 'js/plugins.js' %}"></script>
<!-- Active js -->
<script src="{% static 'js/active.js' %}"></script>

{% endblock  %}